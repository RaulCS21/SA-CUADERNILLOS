<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDwh4DIzzxRyPPzMxCZaIGcdywo-8_h5rk",
        authDomain: "eva-estudiantes.firebaseapp.com",
        databaseURL: "https://eva-estudiantes-default-rtdb.firebaseio.com",
        projectId: "eva-estudiantes",
        storageBucket: "eva-estudiantes.firebasestorage.app",
        messagingSenderId: "692305850400",
        appId: "1:692305850400:web:2b15a925a9669438ad8c45"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const provider = new GoogleAuthProvider();

    document.getElementById('btnLogin').addEventListener('click', () => {
        signInWithPopup(auth, provider)
            .then(async (result) => {
                const user = result.user;
                // Reemplazamos puntos por comas para leer la DB
                const emailKey = user.email.replace(/\./g, ',');
                
                // Referencia a la nueva rama de roles que creamos
                const roleRef = ref(db, `configuracion_roles/${emailKey}`);
                
                try {
                    const snapshot = await get(roleRef);
                    
                    if (snapshot.exists()) {
                        // Es Directivo, Subdirector o Coordinador
                        console.log("Rol especial detectado:", snapshot.val().rol);
                    } else {
                        // No estÃ¡ en la lista: Es un docente normal
                        console.log("Acceso como Docente");
                    }
                    
                    // Redirigir al dashboard
                    window.location.href = 'dashboard.html';
                    
                } catch (error) {
                    console.error("Error al validar rol:", error);
                    window.location.href = 'dashboard.html';
                }
            }).catch((error) => console.error("Error en Login:", error));
    });
</script>